{"version":3,"file":"MapAnchor.js","sources":["MapAnchor.tsx"],"sourcesContent":["// SPDX-FileCopyrightText: 2023 Open Pioneer project (https://github.com/open-pioneer)\n// SPDX-License-Identifier: Apache-2.0\nimport { Box, BoxProps, StyleProps } from \"@open-pioneer/chakra-integration\";\nimport { CommonComponentProps, useCommonComponentProps } from \"@open-pioneer/react-utils\";\nimport { BaseSyntheticEvent, ReactNode, useMemo } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { MapPadding } from \"./MapContainer\";\nimport { useMapContext } from \"./MapContext\";\n\nexport type MapAnchorPosition = \"top-left\" | \"top-right\" | \"bottom-left\" | \"bottom-right\";\n\nconst defaultPosition: MapAnchorPosition = \"top-right\";\n\nexport interface MapAnchorProps extends CommonComponentProps {\n    /**\n     * The position of the anchor container above the map.\n     * @default \"top-right\"\n     */\n    position?: MapAnchorPosition;\n\n    /**\n     * Horizontal gap in pixel applied to anchor container.\n     *\n     * Applied:\n     * - left, if position `*-left`\n     * - right, if position `*-right`\n     *\n     * @default 0\n     */\n    horizontalGap?: number;\n\n    /**\n     * Vertical gap in pixel applied to anchor container.\n     *\n     * Applied:\n     * - top, if position `top-*`\n     * - bottom, if position `bottom-*`\n     *\n     * @default 0 (If position `bottom-*`, default verticalGap == `30`)\n     */\n    verticalGap?: number;\n\n    /**\n     * Prevent some events from the map anchor's children from bubbling towards the map, effectively hiding them from map interactions.\n     * Defaults to `true`.\n     *\n     * If this value is enabled, events such as `pointer-down` are hidden from the map when they occur\n     * within the map anchor.\n     * This is essential when the user wants to select text, or open the browser context menu within the anchor.\n     * If that is not required, set `stopEvents` to `false` instead.\n     */\n    stopEvents?: boolean;\n\n    children?: ReactNode;\n}\n\nexport function MapAnchor(props: MapAnchorProps): JSX.Element {\n    const {\n        position = defaultPosition,\n        stopEvents = true,\n        children,\n        horizontalGap,\n        verticalGap\n    } = props;\n    const { containerProps } = useCommonComponentProps(\"map-anchor\", props);\n    const { padding, mapAnchorsHost } = useMapContext();\n\n    const eventHandlers: Partial<BoxProps> = useMemo(() => {\n        const stopHandler = stopEvents ? stopPropagation : undefined;\n        return {\n            onPointerDown: stopHandler,\n            onPointerUp: stopHandler,\n            onContextMenu: stopHandler\n        };\n    }, [stopEvents]);\n\n    return createPortal(\n        <Box\n            {...containerProps}\n            /* Overlay container uses pointer-events: none, this restores interactivity */\n            pointerEvents=\"auto\"\n            /* Restore user-select: none set by ol-viewport parent */\n            userSelect=\"text\"\n            /** Hide pointer up/down and context menu events from the map parent.  */\n            {...eventHandlers}\n            {...computePositionStyles(position, padding, horizontalGap, verticalGap)}\n        >\n            {children}\n        </Box>,\n        mapAnchorsHost\n    );\n}\n\nexport function computeAttributionGap(verticalGap?: number): {\n    gap: number;\n    space: number;\n} {\n    /**\n     * height of the ol attribution component\n     * improvement: Get height directly from `Attribution` HTMLDivElement\n     */\n    const height = 20;\n\n    /**\n     * additional space between attribution and map anchor container\n     */\n    const space = 10;\n\n    return {\n        gap: verticalGap === undefined ? height + space : 0,\n        space\n    };\n}\n\nexport function computePositionStyles(\n    position: MapAnchorPosition,\n    padding: Required<MapPadding>,\n    horizontalGap?: number | undefined,\n    verticalGap?: number | undefined\n): StyleProps {\n    const props: StyleProps = {\n        position: \"absolute\",\n        transitionProperty: \"left, right, top, bottom\",\n        transitionDuration: \"200ms\",\n        transitionTimingFunction: \"ease-out\"\n    };\n\n    const defaultHorizontalGap = 0;\n    const horizontal = horizontalGap ?? defaultHorizontalGap;\n\n    const defaultVerticalGap = 0;\n    const vertical = verticalGap ?? defaultVerticalGap;\n\n    const attribution = computeAttributionGap(verticalGap);\n    const gap = (n: number) => `${n}px`;\n\n    switch (position) {\n        case \"top-left\":\n            props.left = gap(padding.left + horizontal);\n            props.top = gap(padding.top + vertical);\n            break;\n        case \"top-right\":\n            props.right = gap(padding.right + horizontal);\n            props.top = gap(padding.top + vertical);\n            break;\n        case \"bottom-left\":\n            props.left = gap(padding.left + horizontal);\n            props.bottom = gap(padding.bottom + vertical + attribution.gap);\n            break;\n        case \"bottom-right\":\n            props.right = gap(padding.right + horizontal);\n            props.bottom = gap(padding.bottom + vertical + attribution.gap);\n            break;\n    }\n\n    /**\n     * Apply max-height and max-width to MapAnchor to avoid content overflow\n     */\n    props.maxH = `calc((100%) - ${props.top ?? \"0px\"} - ${\n        props.bottom ?? attribution.gap + \"px\"\n    } - ${vertical + \"px\"} - ${attribution.space + \"px\"})`;\n\n    props.maxW = `calc((100%) - ${props.left ?? \"0px\"} - ${props.right ?? \"0px\"} - ${\n        horizontal + \"px\"\n    })`;\n    props.overflow = \"hidden\";\n\n    return props;\n}\n\nfunction stopPropagation(e: BaseSyntheticEvent) {\n    e.stopPropagation();\n}\n"],"names":[],"mappings":"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"}