{"version":3,"file":"LayerControlComponent.js","sources":["LayerControlComponent.tsx"],"sourcesContent":["// SPDX-FileCopyrightText: con terra GmbH and contributors\n// SPDX-License-Identifier: Apache-2.0\nimport {\n    Checkbox,\n    ScaleFade,\n    Slider,\n    SliderFilledTrack,\n    SliderThumb,\n    SliderTrack,\n    Tooltip\n} from \"@open-pioneer/chakra-integration\";\nimport { OlComponentProps, useMap } from \"@open-pioneer/experimental-ol-map\";\nimport Layer from \"ol/layer/Layer\";\nimport { unByKey } from \"ol/Observable\";\nimport { useIntl } from \"open-pioneer:react-hooks\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useTimeout } from \"react-use\";\n\nexport interface LayerControlProps extends OlComponentProps {\n    /**\n     * Sets visibility of opacity slider\n     */\n    showOpacitySlider?: boolean;\n}\n\nexport function LayerControlComponent(config: LayerControlProps) {\n    const intl = useIntl();\n    const { loading, error, map } = useMap(config.mapId);\n    const layers = useMemo(() => map?.getAllLayers().reverse() ?? [], [map]);\n\n    // Small timeout before \"Loading...\" to optimize for the common case where the map\n    // is available almost immediately. This prevents some flickering in the UI.\n    const [hasTimeoutElapsed] = useTimeout(100);\n    const fadeIn = !loading || hasTimeoutElapsed() || false;\n    return (\n        <ScaleFade in={fadeIn}>\n            {loading ? (\n                <div>{intl.formatMessage({ id: \"loading\" })}</div>\n            ) : error ? (\n                <div>\n                    {intl.formatMessage({ id: \"error\" })} {error.message}\n                </div>\n            ) : (\n                <div>\n                    {layers.map((layer, i) => (\n                        <div key={i} className=\"layer-entry\">\n                            <LayerVisibilityTogglerComponent\n                                layer={layer}\n                            ></LayerVisibilityTogglerComponent>\n                            {config.showOpacitySlider && (\n                                <LayerOpacitySliderComponent\n                                    layer={layer}\n                                ></LayerOpacitySliderComponent>\n                            )}\n                        </div>\n                    ))}\n                </div>\n            )}\n        </ScaleFade>\n    );\n}\n\nfunction LayerVisibilityTogglerComponent(props: { layer: Layer }) {\n    const intl = useIntl();\n    const [visibility, setVisibility] = useState<boolean>(props.layer.getVisible());\n    const title =\n        props.layer.getProperties().title ?? intl.formatMessage({ id: \"undefined-layer-title\" });\n\n    const changeVisibility = () => {\n        setVisibility(!visibility);\n        props.layer.setVisible(!visibility);\n    };\n\n    return (\n        <Checkbox\n            className=\"layer-select\"\n            size=\"lg\"\n            isChecked={visibility}\n            onChange={changeVisibility}\n        >\n            {title}\n        </Checkbox>\n    );\n}\n\nfunction LayerOpacitySliderComponent(props: { layer: Layer }) {\n    const [sliderValue, setSliderValue] = useState(props.layer.getOpacity() * 100);\n    const [showTooltip, setShowTooltip] = useState(false);\n\n    useEffect(() => {\n        const opacityChangeListener = props.layer.on(\"change:opacity\", () => {\n            const opacity = props.layer.getOpacity() * 100;\n            if (opacity !== sliderValue) {\n                setSliderValue(Math.round(opacity));\n            }\n        });\n        return () => unByKey(opacityChangeListener);\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n\n    return (\n        <Slider\n            id=\"slider\"\n            value={sliderValue}\n            min={0}\n            max={100}\n            colorScheme=\"teal\"\n            onChange={(v) => props.layer.setOpacity(v / 100)}\n            onMouseEnter={() => setShowTooltip(true)}\n            onMouseLeave={() => setShowTooltip(false)}\n        >\n            <SliderTrack>\n                <SliderFilledTrack />\n            </SliderTrack>\n            <Tooltip\n                hasArrow\n                bg=\"teal.500\"\n                color=\"white\"\n                placement=\"top\"\n                isOpen={showTooltip}\n                label={`${sliderValue}%`}\n            >\n                <SliderThumb bg=\"teal.500\"></SliderThumb>\n            </Tooltip>\n        </Slider>\n    );\n}\n"],"names":[],"mappings":"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"}