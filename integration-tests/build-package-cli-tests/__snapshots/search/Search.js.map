{"version":3,"file":"Search.js","sources":["Search.tsx"],"sourcesContent":["// SPDX-FileCopyrightText: 2023 Open Pioneer project (https://github.com/open-pioneer)\n// SPDX-License-Identifier: Apache-2.0\nimport { Box, useToken } from \"@open-pioneer/chakra-integration\";\nimport { createLogger, isAbortError } from \"@open-pioneer/core\";\nimport { MapModel, useMapModel } from \"@open-pioneer/map\";\nimport { CommonComponentProps, useCommonComponentProps, useEvent } from \"@open-pioneer/react-utils\";\nimport {\n    ActionMeta,\n    AriaLiveMessages,\n    AriaOnChange,\n    AriaOnFocus,\n    ChakraStylesConfig,\n    InputActionMeta,\n    Select,\n    SelectInstance,\n    SingleValue,\n    Props as SelectProps\n} from \"chakra-react-select\";\nimport { useIntl } from \"open-pioneer:react-hooks\";\nimport { FC, useCallback, useEffect, useMemo, useReducer, useRef, useState } from \"react\";\nimport {\n    ClearIndicator,\n    HighlightOption,\n    IndicatorsContainer,\n    Input,\n    LoadingMessage,\n    MenuComp,\n    NoOptionsMessage,\n    SingleValue as SingleValueComp,\n    ValueContainer\n} from \"./CustomComponents\";\nimport { SearchController, SuggestionGroup } from \"./SearchController\";\nimport { SearchSource, SearchResult } from \"./api\";\nimport { PackageIntl } from \"@open-pioneer/runtime\";\n\nconst LOG = createLogger(\"search:Search\");\n\nexport interface SearchOption {\n    /** Unique value for this option. */\n    value: string;\n\n    /** Display text shown in menu. */\n    label: string;\n\n    /** Search source that returned the suggestion. */\n    source: SearchSource;\n\n    /** The raw result from the search source. */\n    result: SearchResult;\n}\n\nexport interface SearchGroupOption {\n    /** Display text shown in menu. */\n    label: string;\n\n    /** Set of options that belong to this group. */\n    options: SearchOption[];\n}\n\n/**\n * Event type emitted when the user selects an item.\n */\nexport interface SearchSelectEvent {\n    /** The source that returned the {@link result}. */\n    source: SearchSource;\n\n    /** The search result selected by the user. */\n    result: SearchResult;\n}\n\n/**\n * Properties supported by the {@link Search} component.\n */\nexport interface SearchProps extends CommonComponentProps {\n    /**\n     * The id of the map.\n     */\n    mapId: string;\n\n    /**\n     * Data sources to be searched on.\n     */\n    sources: SearchSource[];\n\n    /**\n     * Typing delay (in milliseconds) before the async search query starts after the user types in the search term.\n     * Defaults to `200`.\n     */\n    searchTypingDelay?: number;\n\n    /**\n     * The maximum number of results shown per group.\n     * Defaults to `5`.\n     */\n    maxResultsPerGroup?: number;\n\n    /**\n     * This event handler will be called when the user selects a search result.\n     */\n    onSelect?: (event: SearchSelectEvent) => void;\n\n    /**\n     * This event handler will be called when the user clears the search input.\n     */\n    onClear?: () => void;\n}\n\n/**\n * A component that allows the user to search a given set of {@link SearchSource | SearchSources}.\n */\nexport const Search: FC<SearchProps> = (props) => {\n    const { mapId, sources, searchTypingDelay, maxResultsPerGroup, onSelect, onClear } = props;\n    const { containerProps } = useCommonComponentProps(\"search\", props);\n    const { map } = useMapModel(mapId);\n    const intl = useIntl();\n    const controller = useController(sources, searchTypingDelay, maxResultsPerGroup, map);\n    const { input, search, selectedOption, onInputChanged, onResultConfirmed } =\n        useSearchState(controller);\n\n    const chakraStyles = useChakraStyles();\n    const ariaMessages = useAriaMessages(intl);\n    const components = useCustomComponents();\n\n    const handleInputChange = useEvent((newValue: string, actionMeta: InputActionMeta) => {\n        // Only update the input if the user actually typed something.\n        // This keeps the input content if the user focuses another element or if the menu is closed.\n        if (actionMeta.action === \"input-change\") {\n            onInputChanged(newValue);\n        }\n    });\n\n    const handleSelectChange = useEvent(\n        (value: SingleValue<SearchOption>, actionMeta: ActionMeta<SearchOption>) => {\n            switch (actionMeta.action) {\n                case \"select-option\":\n                    if (value) {\n                        // Updates the input field with the option label\n                        onResultConfirmed(value);\n                        onSelect?.({\n                            source: value.source,\n                            result: value.result\n                        });\n                    }\n                    break;\n                case \"clear\":\n                    // Updates the input field\n                    onInputChanged(\"\");\n\n                    // the next two lines are a workaround for the open bug in react-select regarding the\n                    // cursor not being shown after clearing, although the component is focussed:\n                    // https://github.com/JedWatson/react-select/issues/3871\n                    selectRef.current?.blur();\n                    selectRef.current?.focus();\n                    onClear?.();\n                    break;\n                default:\n                    LOG.debug(`Unhandled action type '${actionMeta.action}'.`);\n                    break;\n            }\n        }\n    );\n\n    const selectRef = useRef<SelectInstance<SearchOption, false, SearchGroupOption>>(null);\n    return (\n        <Box {...containerProps}>\n            <Select<SearchOption, false, SearchGroupOption>\n                className=\"search-component\"\n                classNamePrefix=\"react-select\"\n                ref={selectRef}\n                inputValue={input}\n                onInputChange={handleInputChange}\n                aria-label={intl.formatMessage({ id: \"ariaLabel.search\" })}\n                ariaLiveMessages={ariaMessages}\n                colorScheme=\"trails\"\n                selectedOptionStyle=\"color\"\n                selectedOptionColorScheme=\"trails\"\n                chakraStyles={chakraStyles}\n                isClearable={true}\n                placeholder={intl.formatMessage({ id: \"searchPlaceholder\" })}\n                closeMenuOnSelect={true}\n                isLoading={search.kind === \"loading\"}\n                options={search.kind === \"ready\" ? search.results : undefined}\n                filterOption={() => true} // always show all options (don't filter based on input text)\n                tabSelectsValue={false}\n                components={components}\n                onChange={handleSelectChange}\n                value={selectedOption}\n                menuPosition=\"fixed\"\n            />\n        </Box>\n    );\n};\n\n/**\n * Provides custom aria messages for the select component.\n */\nfunction useAriaMessages(\n    intl: PackageIntl\n): AriaLiveMessages<SearchOption, false, SearchGroupOption> {\n    return useMemo(() => {\n        /**\n         * Method to create Aria-String for focus-Event\n         */\n        const onFocus: AriaOnFocus<SearchOption> = ({ focused }) => {\n            return `${focused.label} ${intl.formatMessage({ id: \"ariaLabel.searchFocus\" })}.`;\n        };\n\n        /**\n         * Method to create Aria-String for value-change-Event\n         */\n        const onChange: AriaOnChange<SearchOption, boolean> = ({ action, label }) => {\n            let message = \"\";\n            switch (action) {\n                case \"select-option\":\n                    message = `${label} ${intl.formatMessage({ id: \"ariaLabel.searchSelect\" })}.`;\n                    break;\n                case \"clear\":\n                    message = `${label} ${intl.formatMessage({ id: \"ariaLabel.searchClear\" })}.`;\n                    break;\n                default:\n                    break;\n            }\n            return message;\n        };\n\n        /**\n         * Method to create Aria-String for instruction\n         */\n        const guidance = () => {\n            return `${intl.formatMessage({ id: \"ariaLabel.instructions\" })}`;\n        };\n\n        /**\n         * Method to create Aria-String for result length\n         */\n        const onFilter = () => {\n            return \"\";\n        };\n\n        return {\n            onFocus,\n            onChange,\n            guidance,\n            onFilter\n        };\n    }, [intl]);\n}\n\n/**\n * Customizes the inner components used by the select component.\n */\nfunction useCustomComponents(): SelectProps<SearchOption, false, SearchGroupOption>[\"components\"] {\n    return useMemo(() => {\n        return {\n            Menu: MenuComp,\n            Input: Input,\n            SingleValue: SingleValueComp,\n            Option: HighlightOption,\n            NoOptionsMessage: NoOptionsMessage,\n            LoadingMessage: LoadingMessage,\n            ValueContainer: ValueContainer,\n            IndicatorsContainer: IndicatorsContainer,\n            ClearIndicator: ClearIndicator\n        };\n    }, []);\n}\n\n/**\n * Customizes components styles within the select component.\n */\nfunction useChakraStyles() {\n    const [groupHeadingBg, focussedItemBg] = useToken(\n        \"colors\",\n        [\"trails.100\", \"trails.50\"],\n        [\"#d5e5ec\", \"#eaf2f5\"]\n    );\n    return useMemo(() => {\n        const chakraStyles: ChakraStylesConfig<SearchOption, false, SearchGroupOption> = {\n            groupHeading: (provided) => ({\n                ...provided,\n                backgroundColor: groupHeadingBg,\n                padding: \"8px 12px\",\n                // make Header look like normal options:\n                fontSize: \"inherit\",\n                fontWeight: \"inherit\"\n            }),\n            option: (provided) => ({\n                ...provided,\n                backgroundColor: \"inherit\",\n                _focus: {\n                    backgroundColor: focussedItemBg\n                }\n            }),\n            dropdownIndicator: (provided) => ({\n                ...provided,\n                display: \"none\" // always hide\n            })\n        };\n        return chakraStyles;\n    }, [groupHeadingBg, focussedItemBg]);\n}\n\n/**\n * Creates a controller to search on the given sources.\n */\nfunction useController(\n    sources: SearchSource[],\n    searchTypingDelay: number | undefined,\n    maxResultsPerGroup: number | undefined,\n    map: MapModel | undefined\n) {\n    const [controller, setController] = useState<SearchController | undefined>(undefined);\n    useEffect(() => {\n        if (!map) {\n            return;\n        }\n        const controller = new SearchController(map, sources);\n        setController(controller);\n        return () => {\n            controller.destroy();\n            setController(undefined);\n        };\n    }, [map, sources]);\n\n    useEffect(() => {\n        controller && (controller.searchTypingDelay = searchTypingDelay);\n    }, [controller, searchTypingDelay]);\n    useEffect(() => {\n        controller && (controller.maxResultsPerSource = maxResultsPerGroup);\n    }, [controller, maxResultsPerGroup]);\n    return controller;\n}\n\ntype SearchResultsReady = {\n    kind: \"ready\";\n    results: SearchGroupOption[];\n};\n\ntype SearchResultsLoading = {\n    kind: \"loading\";\n};\n\ntype SearchResultsState = SearchResultsReady | SearchResultsLoading;\n\n/**\n * Keeps track of the current input text, active searches and their results.\n *\n * NOTE: it would be great to merge this state handling with the search controller\n * in a future revision.\n */\nfunction useSearchState(controller: SearchController | undefined) {\n    interface FullSearchState {\n        query: string;\n        selectedOption: SearchOption | null;\n        search: SearchResultsState;\n    }\n\n    type Action =\n        | { kind: \"input\"; query: string }\n        | { kind: \"select-option\"; option: SearchOption }\n        | { kind: \"load-results\" }\n        | { kind: \"accept-results\"; results: SearchGroupOption[] };\n\n    const [state, dispatch] = useReducer(\n        (current: FullSearchState, action: Action): FullSearchState => {\n            switch (action.kind) {\n                case \"input\":\n                    return {\n                        ...current,\n                        query: action.query,\n                        selectedOption: null\n                    };\n                case \"select-option\":\n                    return {\n                        ...current,\n                        selectedOption: action.option,\n                        query: action.option.label\n                    };\n                case \"load-results\":\n                    return {\n                        ...current,\n                        search: {\n                            kind: \"loading\"\n                        }\n                    };\n                case \"accept-results\":\n                    return {\n                        ...current,\n                        search: {\n                            kind: \"ready\",\n                            results: action.results\n                        }\n                    };\n            }\n        },\n        undefined,\n        (): FullSearchState => ({\n            query: \"\",\n            selectedOption: null,\n            search: {\n                kind: \"ready\",\n                results: []\n            }\n        })\n    );\n\n    // Stores the promise for the current search.\n    // Any results from outdated searches are ignored.\n    const currentSearch = useRef<Promise<unknown>>();\n    const startSearch = useEvent((query: string) => {\n        if (!controller) {\n            currentSearch.current = undefined;\n            dispatch({ kind: \"accept-results\", results: [] });\n            return;\n        }\n\n        LOG.isDebug() && LOG.debug(`Starting new search for query ${JSON.stringify(query)}.`);\n        dispatch({ kind: \"load-results\" });\n        const promise = (currentSearch.current = search(controller, query).then((results) => {\n            // Check if this job is still current\n            if (currentSearch.current === promise) {\n                dispatch({ kind: \"accept-results\", results });\n            }\n        }));\n    });\n\n    // Called when the user confirms a search result\n    const onResultConfirmed = useCallback((option: SearchOption) => {\n        // Do not start a new search when the user confirms a result\n        dispatch({ kind: \"select-option\", option });\n    }, []);\n\n    // Called when a user types into the input field\n    const onInputChanged = useCallback(\n        (newValue: string) => {\n            // Trigger a new search if the user changes the query by typing\n            dispatch({ kind: \"input\", query: newValue });\n            startSearch(newValue);\n        },\n        [startSearch]\n    );\n\n    return {\n        input: state.query,\n        search: state.search,\n        selectedOption: state.selectedOption,\n        onResultConfirmed,\n        onInputChanged\n    };\n}\n\nasync function search(controller: SearchController, query: string): Promise<SearchGroupOption[]> {\n    let suggestions: SuggestionGroup[];\n    try {\n        suggestions = await controller.search(query);\n    } catch (error) {\n        if (!isAbortError(error)) {\n            LOG.error(`Search failed`, error);\n        }\n        suggestions = [];\n    }\n    return mapSuggestions(suggestions);\n}\n\nfunction mapSuggestions(suggestions: SuggestionGroup[]): SearchGroupOption[] {\n    const options = suggestions.map(\n        (group, groupIndex): SearchGroupOption => ({\n            label: group.label,\n            options: group.results.map((suggestion): SearchOption => {\n                return {\n                    value: `${groupIndex}-${suggestion.id}`,\n                    label: suggestion.label,\n                    source: group.source,\n                    result: suggestion\n                };\n            })\n        })\n    );\n    return options;\n}\n"],"names":["search","SingleValueComp","controller"],"mappings":"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"}