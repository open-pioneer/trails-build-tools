{"version":3,"file":"MapAnchor.js","sources":["MapAnchor.tsx"],"sourcesContent":["// SPDX-FileCopyrightText: 2023 Open Pioneer project (https://github.com/open-pioneer)\n// SPDX-License-Identifier: Apache-2.0\nimport { Box, BoxProps, StyleProps } from \"@open-pioneer/chakra-integration\";\nimport { CommonComponentProps, useCommonComponentProps } from \"@open-pioneer/react-utils\";\nimport { BaseSyntheticEvent, ReactNode, useMemo } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { MapPadding } from \"../api\";\nimport { useMapContext } from \"./MapContext\";\n\nexport type MapAnchorPosition = \"top-left\" | \"top-right\" | \"bottom-left\" | \"bottom-right\";\n\nconst defaultPosition: MapAnchorPosition = \"top-right\";\n\nexport interface MapAnchorProps extends CommonComponentProps {\n    /**\n     * The position of the anchor container above the map.\n     * @default \"top-right\"\n     */\n    position?: MapAnchorPosition;\n\n    /**\n     * Horizontal gap in pixel applied to anchor container.\n     *\n     * Applied:\n     * - left, if position `*-left`\n     * - right, if position `*-right`\n     *\n     * @default 0\n     */\n    horizontalGap?: number;\n\n    /**\n     * Vertical gap in pixel applied to anchor container.\n     *\n     * Applied:\n     * - top, if position `top-*`\n     * - bottom, if position `bottom-*`\n     *\n     * @default 0 (If position `bottom-*`, default verticalGap == `30`)\n     */\n    verticalGap?: number;\n\n    /**\n     * Prevent some events from the map anchor's children from bubbling towards the map, effectively hiding them from map interactions.\n     * Defaults to `true`.\n     *\n     * If this value is enabled, events such as `pointer-down` are hidden from the map when they occur\n     * within the map anchor.\n     * This is essential when the user wants to select text, or open the browser context menu within the anchor.\n     * If that is not required, set `stopEvents` to `false` instead.\n     */\n    stopEvents?: boolean;\n\n    children?: ReactNode;\n}\n\nexport function MapAnchor(props: MapAnchorProps): JSX.Element {\n    const {\n        position = defaultPosition,\n        stopEvents = true,\n        children,\n        horizontalGap,\n        verticalGap\n    } = props;\n    const { containerProps } = useCommonComponentProps(\"map-anchor\", props);\n    const { padding, mapAnchorsHost } = useMapContext();\n\n    const eventHandlers: Partial<BoxProps> = useMemo(() => {\n        const stopHandler = stopEvents ? stopPropagation : undefined;\n        return {\n            onPointerDown: stopHandler,\n            onPointerUp: stopHandler,\n            onContextMenu: stopHandler\n        };\n    }, [stopEvents]);\n\n    return createPortal(\n        <Box\n            {...containerProps}\n            /* Overlay container uses pointer-events: none, this restores interactivity */\n            pointerEvents=\"auto\"\n            /* Restore user-select: none set by ol-viewport parent */\n            userSelect=\"text\"\n            /** Hide pointer up/down and context menu events from the map parent.  */\n            {...eventHandlers}\n            {...computePositionStyles(position, padding, horizontalGap, verticalGap)}\n        >\n            {children}\n        </Box>,\n        mapAnchorsHost\n    );\n}\n\nexport function computeAttributionGap(verticalGap?: number): {\n    gap: number;\n    space: number;\n} {\n    /**\n     * height of the ol attribution component\n     * improvement: Get height directly from `Attribution` HTMLDivElement\n     */\n    const height = 20;\n\n    /**\n     * additional space between attribution and map anchor container\n     */\n    const space = 10;\n\n    return {\n        gap: verticalGap === undefined ? height + space : 0,\n        space\n    };\n}\n\nexport function computePositionStyles(\n    position: MapAnchorPosition,\n    padding: Required<MapPadding>,\n    horizontalGap?: number | undefined,\n    verticalGap?: number | undefined\n): StyleProps {\n    const props: StyleProps = {\n        position: \"absolute\",\n        transitionProperty: \"left, right, top, bottom\",\n        transitionDuration: \"200ms\",\n        transitionTimingFunction: \"ease-out\"\n    };\n\n    const defaultHorizontalGap = 0;\n    const horizontal = horizontalGap ?? defaultHorizontalGap;\n\n    const defaultVerticalGap = 0;\n    const vertical = verticalGap ?? defaultVerticalGap;\n\n    const attribution = computeAttributionGap(verticalGap);\n    const gap = (n: number) => `${n}px`;\n\n    switch (position) {\n        case \"top-left\":\n            props.left = gap(padding.left + horizontal);\n            props.top = gap(padding.top + vertical);\n            break;\n        case \"top-right\":\n            props.right = gap(padding.right + horizontal);\n            props.top = gap(padding.top + vertical);\n            break;\n        case \"bottom-left\":\n            props.left = gap(padding.left + horizontal);\n            props.bottom = gap(padding.bottom + vertical + attribution.gap);\n            break;\n        case \"bottom-right\":\n            props.right = gap(padding.right + horizontal);\n            props.bottom = gap(padding.bottom + vertical + attribution.gap);\n            break;\n    }\n\n    /**\n     * Apply max-height and max-width to MapAnchor to avoid content overflow\n     */\n    props.maxH = `calc((100%) - ${props.top ?? \"0px\"} - ${\n        props.bottom ?? attribution.gap + \"px\"\n    } - ${vertical + \"px\"} - ${attribution.space + \"px\"})`;\n\n    props.maxW = `calc((100%) - ${props.left ?? \"0px\"} - ${props.right ?? \"0px\"} - ${\n        horizontal + \"px\"\n    })`;\n    props.overflow = \"hidden\";\n\n    return props;\n}\n\nfunction stopPropagation(e: BaseSyntheticEvent) {\n    e.stopPropagation();\n}\n"],"names":[],"mappings":"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"}